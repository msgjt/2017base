<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	template="templates/template.xhtml">

	<ui:define name="content">



		<h:form id="form1">

			<p:panelGrid columns="1">
				<p:commandLink styleClass="buttonLink"
					update=":mainForm:form1:addItinerary"
					oncomplete="PF('addItineraryDialog').show()"
					title="#{msg['itinerary.itineraryAdd']}"
					value="#{msg['itinerary.itineraryAdd']}">
				</p:commandLink>
			</p:panelGrid>

			<p:dialog header="#{msg['itinerary.itineraryAdd']}"
				widgetVar="addItineraryDialog" showEffect="blind"
				hideEffect="explode" resizable="false" height="350" width="500">

				<p:outputPanel id="addItinerary" style="text-align:center;">
					<p:panelGrid columns="2">
						<h:outputLabel value="#{msg['manageitineraries.itineraryName']}" />
						<p:inputText value="#{itineraryBean.itineraryName}">
						</p:inputText>


						<p:outputLabel for="company" value="#{msg['company.company']}"></p:outputLabel>
						<p:selectOneMenu id="company" value="#{itineraryBean.company}"
							converter="companyConverter">
							<f:selectItems value="#{itineraryBean.companyList}" var="company"
								itemLabel="#{company.companyName}" itemValue="#{company}" />
						</p:selectOneMenu>



						<h:commandButton value="#{msg['manageitineraries.addItinerary']}"
							action="#{itineraryBean.addItinerary}">
						</h:commandButton>


					</p:panelGrid>

				</p:outputPanel>
			</p:dialog>
		</h:form>

		<br />
		<br />

		<h:form id="form2">

			<p:panelGrid columns="4">


				<p:selectOneMenu id="companyList" value="#{itineraryBean.company}"
					converter="companyConverter">
					<f:selectItem noSelectionOption="true"
						itemLabel="#{msg['company.selectCompany']}" />
					<f:selectItems value="#{itineraryBean.companyList}" var="company"
						itemLabel="#{company.companyName}" itemValue="#{company}" />
					<p:ajax event="change" listener="#{itineraryBean.loadItineraries}"
						update="#{p:component('itinerary')} #{p:component('itineraries')}"></p:ajax>
				</p:selectOneMenu>


				<p:selectOneMenu id="itinerary" value="#{itineraryBean.itinerary}"
					converter="itineraryConverter">
					<f:selectItem noSelectionOption="true"
						itemLabel="#{msg['itinerary.selectItinerary']}" />
					<f:selectItems value="#{itineraryBean.itinerariesList}"
						var="itinerary" itemLabel="#{itinerary.itineraryName}"
						itemValue="#{itinerary}" />
					<p:ajax event="change" listener="#{itineraryBean.loadFlights}"
						update="#{p:component('flightMenuAdd')} #{p:component('itineraryFlights')}"></p:ajax>
				</p:selectOneMenu>







				<p:selectOneMenu id="flightMenuAdd" value="#{itineraryBean.flight}"
					converter="flightConverter" var="f" filter="true"
					filterMatchMode="contains" showCheckbox="true">
					<f:selectItems value="#{itineraryBean.flightList}" var="flight"
						itemLabel="#{flight.airport1.airportName} - #{flight.airport2.airportName}"
						itemValue="#{flight}" />
					<p:column>
						<h:outputText
							value="#{f.airport1.airportName} - #{f.airport2.airportName}"></h:outputText>
					</p:column>
				</p:selectOneMenu>



				<p:commandButton value="#{msg['op.add']}"
					action="#{itineraryBean.addFlight}" process="@this,form2"
					update="#{p:component('flightMenuAdd')} #{p:component('itineraryFlights')} #{p:component('itineraries')}" />

			</p:panelGrid>

			<p:dataTable id="itineraryFlights" var="if"
				value="#{itineraryBean.itinerary.flights}" editable="false"
				scrollable="true" scrollHeight="200">

				<f:facet name="header">
	         				#{msg['itinerary.content']}
	      			 </f:facet>



				<p:column headerText="#{msg['itinerary.flightId']}"
					style="width:60px">
					<h:outputText value="#{if.flightId}" />
				</p:column>

				<p:column headerText="#{msg['itinerary.from']}">
					<h:outputText value="#{if.airport1.airportName}" />
				</p:column>

				<p:column headerText="#{msg['itinerary.to']}">
					<h:outputText value="#{if.airport2.airportName}" />
				</p:column>

				<p:column headerText="#{msg['itinerary.departure']}">
					<h:outputText value="#{if.startDate}" />
				</p:column>

				<p:column headerText="#{msg['itinerary.arrival']}">
					<h:outputText value="#{if.endDate}" />
				</p:column>
			</p:dataTable>
		</h:form>



		<h:form id="form3">

			<p:growl id="msgs" showDetail="true" />

			<p:dataTable id="itineraries" var="itinerary"
				value="#{itineraryBean.itinerariesList}" editable="true"
				style="margin-bottom:20px" scrollable="true" scrollHeight="400">

				<f:facet name="header">
         			#{msg['manageitineraries.itineraryName']}
      			 </f:facet>

				<p:ajax event="rowEdit" listener="#{itineraryBean.onRowEdit}"
					update="#{p:component('msgs')} #{p:component('itinerary')}" />
				<p:ajax event="rowEditCancel"
					listener="#{itineraryBean.onRowCancel}"
					update="#{p:component('msgs')}" />

				<p:column headerText="#{msg['manageitineraries.itineraryName']}">
					<p:cellEditor>
						<f:facet name="output">
							<h:outputText value="#{itinerary.itineraryName}" />
						</f:facet>
						<f:facet name="input">
							<p:inputText id="modelInput" value="#{itinerary.itineraryName}"
								style="width:100%" />
						</f:facet>
					</p:cellEditor>
				</p:column>

				<p:column headerText="#{msg['itinerary.from']}">
					<h:outputText value="#{itinerary.airport1.airportName}" />
				</p:column>

				<p:column headerText="#{msg['itinerary.from']}">
					<h:outputText value="#{itinerary.airport2.airportName}" />
				</p:column>




				<p:column style="width:32px">
					<p:rowEditor />



					<p:commandButton icon="ui-icon-trash" process="@this,itineraries"
						actionListener="#{itineraryBean.deleteItinerary(itinerary)}"
						action="manageitineraries.xhtml?faces-redirect=true"
						update="#{p:component('msgs')}">
						<p:confirm header="Confirmation"
							message="#{msg['op.confirmDelete']}" icon="ui-icon-alert" />
					</p:commandButton>


					<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
						<p:commandButton value="#{msg['op.yes']}" type="button"
							styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
						<p:commandButton value="#{msg['op.no']}" type="button"
							styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
					</p:confirmDialog>

				</p:column>

			</p:dataTable>

		</h:form>






	</ui:define>

</ui:composition>
