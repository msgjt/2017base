<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:pe="http://primefaces.org/ui/extensions"
	template="templates/template.xhtml">

	<ui:define name="content">


		<h:form id="form">
			<p:growl id="msgs" showDetail="true" />

			<p:panelGrid columns="1">
				<p:commandLink styleClass="buttonLink" update=":mainForm:form:panel"
					oncomplete="PF('dlg').show()" title="teszt"
					value="#{msg['flightTemplate.addNewTemplate']}">
				</p:commandLink>
			</p:panelGrid>

			<p:dialog header="#{msg['flightTemplate.popup']}" widgetVar="dlg"
				resizable="false" showEffect="blind" hideEffect="explode"
				height="350" width="500">
				<p:outputPanel id="panel" style="text-align:center;">
					<p:panelGrid columns="2">

						<p:outputLabel for="departure"
							value="#{msg['flightTemplate.startAirport']}" />
						<p:selectOneMenu id="departure" value="#{templateBean.airport1}"
							converter="airportConverter" binding="#{startAirComponent}"
							styleClass="selectMenu">
							<f:selectItems value="#{templateBean.airportList}" var="airport1"
								itemLabel="#{airport1.airportName}" itemValue="#{airport1}" />
							<f:selectItem itemValue="#{null}" itemLabel="" />
						</p:selectOneMenu>

						<p:outputLabel for="destination"
							value="#{msg['flightTemplate.endAirport']}" />
						<p:selectOneMenu id="destination" value="#{templateBean.airport2}"
							converter="airportConverter" styleClass="selectMenu">
							<f:selectItems value="#{templateBean.airportList}" var="airport2"
								itemLabel="#{airport2.airportName}" itemValue="#{airport2}" />
							<f:selectItem itemValue="#{null}" itemLabel="" />
							<f:validator validatorId="EqualsValidator" />
							<f:attribute name="otherValue" value="#{startAirComponent.value}" />
						</p:selectOneMenu>

						<p:outputLabel for="popup"
							value="#{msg['flightTemplate.startDate']}" />
						<p:calendar id="popup" value="#{templateBean.startDate}"
							pattern="MM/dd/yyyy HH:mm" binding="#{startDComponent}" />

						<p:outputLabel for="popup2"
							value="#{msg['flightTemplate.endDate']}" />
						<p:calendar id="popup2" value="#{templateBean.endDate}"
							pattern="MM/dd/yyyy HH:mm">
							<f:validator validatorId="DateValidator" />
							<f:attribute name="otherValue" value="#{startDComponent.value}" />
						</p:calendar>

						<p:outputLabel for="company" value="#{msg['company.company']}"></p:outputLabel>
						<p:selectOneMenu id="company" value="#{templateBean.company}"
							converter="companyConverter"
							valueChangeListener="#{templateBean.selectOneMenuListener}"
							styleClass="selectMenu">
							<f:selectItems value="#{templateBean.companyList}" var="company"
								itemLabel="#{company.companyName}" itemValue="#{company}" />
								<f:selectItem itemValue="#{null}" itemLabel="" />
							<f:ajax event="change" execute="@form" render="plane" />
						</p:selectOneMenu>

						<p:outputLabel for="plane" value="#{msg['flightTemplate.plane']}" />
						<p:selectOneMenu id="plane" value="#{templateBean.plane}"
							converter="planeConverter" styleClass="selectMenu">
							<f:selectItems value="#{templateBean.planeList}" var="plane"
								itemLabel="#{plane.model}" itemValue="#{plane}" />
							<f:selectItem itemValue="#{null}" itemLabel="" />
						</p:selectOneMenu>


						<h:commandButton value="#{msg['op.insert']}"
							action="#{templateBean.processInsert}" update="panel">
						</h:commandButton>

					</p:panelGrid>
				</p:outputPanel>
			</p:dialog>


			<p:dataTable value="#{templateBean.flightTemplateList}"
				var="template" editable="true" id="report"
				style="margin-bottom:20px" scrollable="true" scrollHeight="600">

				<f:facet name="header">
						Flight Templates
   					</f:facet>

				<p:ajax event="rowEdit" listener="#{templateBean.onRowEdit}"
					update="#{p:component('msgs')}" />
				<p:ajax event="rowEditCancel" listener="#{templateBean.onRowCancel}"
					update="#{p:component('msgs')}" />

				<p:column headerText="#{msg['flightTemplate.startAirport']}">
					<p:cellEditor>
						<f:facet name="output">
							<h:outputText value="#{template.airport1.airportName}" />
						</f:facet>
						<f:facet name="input">
							<p:selectOneMenu id="airport1" value="#{template.airport1}"
								converter="airportConverter" binding="#{airport1Component}"
								styleClass="selectMenu">
								<f:selectItems value="#{templateBean.airportList}"
									var="airport1" itemLabel="#{airport1.airportName}"
									itemValue="#{airport1}" />
								<f:selectItem itemValue="#{null}" itemLabel="" />
							</p:selectOneMenu>
						</f:facet>
					</p:cellEditor>
				</p:column>

				<p:column headerText="#{msg['flightTemplate.endAirport']}">
					<p:cellEditor>
						<f:facet name="output">
							<h:outputText value="#{template.airport2.airportName}" />
						</f:facet>
						<f:facet name="input">
							<p:selectOneMenu id="tableAirport2" value="#{template.airport2}"
								converter="airportConverter" styleClass="selectMenu">
								<f:selectItems value="#{templateBean.airportList}"
									var="airport2" itemLabel="#{airport2.airportName}"
									itemValue="#{airport2}" />
								<f:selectItem itemValue="#{null}" itemLabel="" />
								<f:validator validatorId="EqualsValidator" />
								<f:attribute name="otherValue"
									value="#{airport1Component.value}" />
							</p:selectOneMenu>
						</f:facet>
					</p:cellEditor>
				</p:column>

				<p:column headerText="#{msg['flightTemplate.startDate']}">
					<p:cellEditor>
						<f:facet name="output">
							<h:outputText value="#{template.startDate}">
								<f:convertDateTime type="date" pattern="dd-MM-yyyy HH:mm" />
							</h:outputText>
						</f:facet>
						<f:facet name="input">
							<p:calendar id="popup1" value="#{template.startDate}"
								pattern="MM/dd/yyyy HH:mm" binding="#{startDateComponent}">
							</p:calendar>
						</f:facet>
					</p:cellEditor>
				</p:column>

				<p:column headerText="#{msg['flightTemplate.endDate']}">
					<p:cellEditor>
						<f:facet name="output">
							<h:outputText value="#{template.endDate}"
								pattern="MM/dd/yyyy HH:mm">
								<f:convertDateTime type="date" pattern="dd-MM-yyyy HH:mm" />
							</h:outputText>
						</f:facet>
						<f:facet name="input">
							<p:calendar id="popup2" value="#{template.endDate}"
								pattern="MM/dd/yyyy HH:mm">
								<f:validator validatorId="DateValidator" />
								<f:attribute name="otherValue"
									value="#{startDateComponent.value}" />
							</p:calendar>
						</f:facet>
					</p:cellEditor>
				</p:column>

				<p:column headerText="#{msg['flightTemplate.plane']}">
					<p:cellEditor>
						<f:facet name="output">
							<h:outputText value="#{template.plane.model}" />
						</f:facet>
						<f:facet name="input">
							<p:selectOneMenu id="planeSelect" value="#{template.plane}"
								converter="planeConverter" styleClass="selectMenu">
								<f:selectItems value="#{template.company.availablePlanes}"
									var="plane" itemLabel="#{plane.model}" itemValue="#{plane}" />
								<f:selectItem itemValue="#{null}" itemLabel="" />
							</p:selectOneMenu>
						</f:facet>
					</p:cellEditor>
				</p:column>

				<p:column headerText="#{msg['company.company']}">
					<p:cellEditor>
						<f:facet name="output">
							<h:outputText value="#{template.company.companyName}" />
						</f:facet>
						<f:facet name="input">
							<p:selectOneMenu id="companyList" value="#{template.company}"
								converter="companyConverter" styleClass="selectMenu">
								<f:selectItems value="#{templateBean.companyList}" var="company"
									itemLabel="#{company.companyName}" itemValue="#{company}" />
								<f:selectItem itemValue="#{null}" itemLabel="" />
								<p:ajax event="change" update="#{p:component('planeSelect')}"></p:ajax>
							</p:selectOneMenu>
						</f:facet>
					</p:cellEditor>
				</p:column>

				<p:column style="width:32px">
					<p:rowEditor />

					<p:commandButton update="report #{p:component('msgs')}"
						icon="ui-icon-trash" action="#{templateBean.delete(template)}"
						style="width:25px;height:15x" immediate="true">
						<p:confirm header="Confirmation"
							message="#{msg['flightTemplate.areYouSure']}"
							icon="ui-icon-alert" />
					</p:commandButton>

					<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
						<p:commandButton value="#{msg['flightTemplate.yes']}"
							type="button" update="#{p:component('msgs')}"
							styleClass="ui-confirmdialog-yes" icon="ui-icon-check"
							immediate="true" />
						<p:commandButton value="#{msg['flightTemplate.no']}" type="button"
							styleClass="ui-confirmdialog-no" icon="ui-icon-close"
							immediate="true" />
					</p:confirmDialog>

				</p:column>

			</p:dataTable>
		</h:form>

	</ui:define>

</ui:composition>
