<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:pe="http://primefaces.org/ui/extensions"
	template="templates/template.xhtml">

	<ui:define name="content">

		<h:form id="form">
			<p:growl id="msgs" showDetail="true" />

			<p:panelGrid columns="1">

				<p:commandLink update=":mainForm:form:addFlight"
					oncomplete="PF('addFlightDialog').show()"
					title="#{msg['manageflights.link']}" styleClass="buttonLink"
					value="#{msg['manageflights.link']}">
				</p:commandLink>

				<p:commandLink update=":mainForm:form:addFlightFromTemplate"
					oncomplete="PF('addFlightFromTemplateDialog').show()"
					title="#{msg['manageflights.linkforTemplate']}"
					styleClass="buttonLink"
					value="#{msg['manageflights.linkforTemplate']}:"
					actionListener="#{flightsBean.createFlightFromTemplate}">
				</p:commandLink>

				<p:selectOneMenu id="flightTemplateDTO"
					value="#{flightsBean.flightTemplateDTO}"
					converter="flightTemplateConverter" styleClass="selectMenu">
					<f:selectItems value="#{flightsBean.flightTemplateList}"
						var="flightTemplateDTO"
						itemLabel="#{flightTemplateDTO.airport1.airportName} - #{flightTemplateDTO.airport2.airportName} "
						itemValue="#{flightTemplateDTO}" />
					<p:ajax event="change" update="#{p:component('dt')}"></p:ajax>
				</p:selectOneMenu>




			</p:panelGrid>


			<p:dialog header="#{msg['manageflights.popUpforTemplate']}"
				widgetVar="addFlightFromTemplateDialog" showEffect="blind"
				hideEffect="explode" resizable="false" height="250" width="1200">

				<p:outputPanel id="addFlightFromTemplate" style="text-align:center;">

					<p:dataTable id="dt" value="#{flightsBean.flightTemplateDTO}"
						var="flightTempl" editable="true">

						<p:ajax event="rowEdit" listener="#{flightsBean.onRowEdit2}"
							update="#{p:component('msgs')}" />
						<p:ajax event="rowEditCancel"
							listener="#{flightsBean.onRowCancel2}"
							update="#{p:component('msgs')}" />




						<p:column headerText="#{msg['manageflights.departureAirport']} ">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText value="#{flightTempl.airport1.airportName}" />
								</f:facet>
								<f:facet name="input">
									<p:selectOneMenu id="airport1" value="#{flightTempl.airport1}"
										converter="airportConverter" binding="#{startAirComponent}"
										styleClass="selectMenu">
										<f:selectItems value="#{flightsBean.allAirports}"
											var="airport1" itemLabel="#{airport1.airportName}"
											itemValue="#{airport1}" />
									</p:selectOneMenu>
								</f:facet>
							</p:cellEditor>
						</p:column>

						<p:column headerText="#{msg['manageflights.arrivalAirport']} ">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText value="#{flightTempl.airport2.airportName}" />
								</f:facet>
								<f:facet name="input">
									<p:selectOneMenu id="airport2" value="#{flightTempl.airport2}"
										converter="airportConverter" styleClass="selectMenu">
										<f:selectItems value="#{flightsBean.allAirports}"
											var="airport2" itemLabel="#{airport2.airportName}"
											itemValue="#{airport2}" />
										<f:validator validatorId="EqualsValidator" />
										<f:attribute name="otherValue"
											value="#{startAirComponent.value}" />
									</p:selectOneMenu>
								</f:facet>
							</p:cellEditor>
						</p:column>

						<p:column headerText="#{msg['flight.startDate']}">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText value="#{flightTempl.startDate}">
										<f:convertDateTime pattern="MM/dd/yyyy HH:mm" />
									</h:outputText>
								</f:facet>
								<f:facet name="input">
									<p:outputLabel for="startDate" />
									<p:calendar id="startDate" value="#{flightTempl.startDate}"
										pattern="MM/dd/yyyy HH:mm" binding="#{startDComponent}" />
								</f:facet>
							</p:cellEditor>
						</p:column>


						<p:column headerText="#{msg['flight.endDate']}">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText value="#{flightTempl.endDate}">
										<f:convertDateTime pattern="MM/dd/yyyy HH:mm" />
									</h:outputText>
								</f:facet>
								<f:facet name="input">
									<p:outputLabel for="endDate" />
									<p:calendar id="endDate" value="#{flightTempl.endDate}"
										pattern="MM/dd/yyyy HH:mm">
										<f:validator validatorId="DateValidatorForFlights" />
										<f:attribute name="otherValue"
											value="#{startDComponent.value}" />
									</p:calendar>
								</f:facet>
							</p:cellEditor>
						</p:column>

						<p:column headerText="#{msg['manageflights.company']} ">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText value="#{flightTempl.company.companyName}" />
								</f:facet>
								<f:facet name="input">
									<p:selectOneMenu id="company" value="#{flightTempl.company}"
										converter="companyConverter" styleClass="selectMenu">
										<f:selectItems value="#{flightsBean.allCompanies}"
											var="company" itemLabel="#{company.companyName}"
											itemValue="#{company}" />
										<p:ajax event="change" update="#{p:component('plane1')}"></p:ajax>
									</p:selectOneMenu>
								</f:facet>
							</p:cellEditor>
						</p:column>

						<p:column headerText="#{msg['manageflights.plane']}">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText value="#{flightTempl.plane.model}" />
								</f:facet>
								<f:facet name="input">
									<p:selectOneMenu id="plane1" value="#{flightTempl.plane}"
										converter="planeConverter" styleClass="selectMenu">
										<f:selectItems value="#{flightTempl.company.availablePlanes}"
											var="plane" itemLabel="#{plane.model}" itemValue="#{plane}" />
									</p:selectOneMenu>
								</f:facet>
							</p:cellEditor>
						</p:column>


						<p:column style="width:32px">
							<p:rowEditor />
						</p:column>
					</p:dataTable>

					<h:commandButton style="float:left;height:40px;width:120px"
						value="#{msg['manageflights.addFlight']}"
						action="#{flightsBean.addFlightFromTemplate}">
					</h:commandButton>
				</p:outputPanel>
			</p:dialog>

			<br />
			<br />





			<p:dialog header="#{msg['manageflights.popUp']}"
				widgetVar="addFlightDialog" showEffect="blind" hideEffect="explode"
				resizable="false" height="450" width="600">

				<p:outputPanel id="addFlight" style="text-align:center;">
					<p:panelGrid columns="2">

						<p:outputLabel for="company" value="#{msg['company.company']}"></p:outputLabel>
						<p:selectOneMenu id="company" value="#{flightsBean.company}"
							converter="companyConverter"
							valueChangeListener="#{flightsBean.selectOneMenuListener}"
							styleClass="selectMenu">
							<f:ajax event="change" execute="@form" render="plane2" />
							<f:selectItems value="#{flightsBean.allCompanies}" var="company"
								itemLabel="#{company.companyName}" itemValue="#{company}" />
						</p:selectOneMenu>

						<p:outputLabel for="plane2" value="#{msg['plane.plane']}"></p:outputLabel>
						<p:selectOneMenu id="plane2" value="#{flightsBean.plane}"
							converter="planeConverter" styleClass="selectMenu">
							<f:selectItems value="#{flightsBean.allPlanes}" var="plane"
								itemLabel="#{plane.model}" itemValue="#{plane}" />
						</p:selectOneMenu>

						<p:outputLabel for="airport1" value="#{msg['airport.airport1']}"></p:outputLabel>
						<p:selectOneMenu id="airport1" value="#{flightsBean.airport1}"
							converter="airportConverter" styleClass="selectMenu">
							<f:selectItems value="#{flightsBean.allAirports}" var="airport1"
								itemLabel="#{airport1.airportName}" itemValue="#{airport1}" />
						</p:selectOneMenu>

						<p:outputLabel for="airport2" value="#{msg['airport.airport2']}"></p:outputLabel>
						<p:selectOneMenu id="airport2" value="#{flightsBean.airport2}"
							converter="airportConverter" styleClass="selectMenu">
							<f:selectItems value="#{flightsBean.allAirports}" var="airport2"
								itemLabel="#{airport2.airportName}" itemValue="#{airport2}" />
						</p:selectOneMenu>

						<p:outputLabel for="datetime1" value="#{msg['flight.startDate']}" />
						<p:calendar id="datetime1" value="#{flightsBean.startDate}"
							pattern="MM/dd/yyyy HH:mm" />

						<p:outputLabel for="datetime2" value="#{msg['flight.endDate']}" />
						<p:calendar id="datetime2" value="#{flightsBean.endDate}"
							pattern="MM/dd/yyyy HH:mm" />

						<h:commandButton value="#{msg['manageflights.addFlight']}"
							action="#{flightsBean.processInsert}">
						</h:commandButton>
					</p:panelGrid>
				</p:outputPanel>
			</p:dialog>

				<p:dataTable id="dataTable" value="#{flightsBean.flightsList}"
					editable="true" var="flight" scrollHeight="600">

					<f:facet name="header">
						<h:outputText value="#{msg['flight.flightTable']}"></h:outputText>
					</f:facet>

					<p:ajax event="rowEdit" listener="#{flightsBean.onRowEdit}"
						update="#{p:component('msgs')}" />
					<p:ajax event="rowEditCancel" listener="#{flightsBean.onRowCancel}"
						update="#{p:component('msgs')}" />
					<p:ajax event="rowEditInit" listener="#{flightsBean.onRowEditInit}"
						update="#{p:component('msgs')}" />

					<p:column headerText="#{msg['flight.startDate']}">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{flight.startDate}">
									<f:convertDateTime pattern="MM/dd/yyyy HH:mm" />
								</h:outputText>
							</f:facet>
							<f:facet name="input">
								<p:outputLabel for="datetime3" />
								<p:calendar id="datetime3" value="#{flight.startDate}"
									pattern="MM/dd/yyyy HH:mm" binding="#{start3}" />
							</f:facet>
						</p:cellEditor>
					</p:column>

					<p:column headerText="#{msg['flight.endDate']}">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{flight.endDate}">
									<f:convertDateTime pattern="MM/dd/yyyy HH:mm" />
								</h:outputText>
							</f:facet>
							<f:facet name="input">
								<p:outputLabel for="datetime4" />
								<p:calendar id="datetime4" value="#{flight.endDate}"
									pattern="MM/dd/yyyy HH:mm">
									<f:validator validatorId="DateValidatorForFlights" />
									<f:attribute name="otherValue" value="#{start3.value}" />
								</p:calendar>
							</f:facet>
						</p:cellEditor>
					</p:column>

					<p:column headerText="#{msg['company.company']}">
						<h:outputText value="#{flight.company.companyName}" />
					</p:column>

					<p:column headerText="#{msg['plane.plane']}">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{flight.plane.model}" />
							</f:facet>
							<f:facet name="input">
								<p:selectOneMenu id="plane3" value="#{flight.plane}"
									converter="planeConverter" styleClass="selectMenu">
									<f:selectItems value="#{flight.company.availablePlanes}"
										var="plane" itemLabel="#{plane.model}" itemValue="#{plane}" />
								</p:selectOneMenu>
							</f:facet>
						</p:cellEditor>
					</p:column>

					<p:column headerText="#{msg['airport.airport1']}">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{flight.airport1.airportName}" />
							</f:facet>
							<f:facet name="input">
								<p:selectOneMenu id="airport1" value="#{flight.airport1}"
									converter="airportConverter" binding="#{startAirport3}"
									styleClass="selectMenu">
									<f:selectItems value="#{flightsBean.allAirports}"
										var="airport1" itemLabel="#{airport1.airportName}"
										itemValue="#{airport1}" />
								</p:selectOneMenu>
							</f:facet>
						</p:cellEditor>
					</p:column>

					<p:column headerText="#{msg['airport.airport2']}">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{flight.airport2.airportName}" />
							</f:facet>
							<f:facet name="input">
								<p:selectOneMenu id="airport2" value="#{flight.airport2}"
									converter="airportConverter" styleClass="selectMenu">
									<f:selectItems value="#{flightsBean.allAirports}"
										var="airport2" itemLabel="#{airport2.airportName}"
										itemValue="#{airport2}" />
									<f:validator validatorId="EqualsValidator" />
									<f:attribute name="otherValue" value="#{startAirport3.value}" />
								</p:selectOneMenu>
							</f:facet>
						</p:cellEditor>
					</p:column>


					<p:column style="width:32px">
						<p:rowEditor />


						<p:commandButton update="#{p:component('msgs')}"
							icon="ui-icon-trash"
							action="manageflights.xhtml?faces-redirect=true"
							style="width:25px;height:15x" immediate="true"
							actionListener="#{flightsBean.rowDelete(flight)}">
							<p:confirm header="Confirmation"
								message="#{msg['op.confirmDeleteFlight']}" icon="ui-icon-alert" />
						</p:commandButton>

						<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
							<p:commandButton value="#{msg['op.yes']}" type="button"
								styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
							<p:commandButton value="#{msg['op.no']}" type="button"
								styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
						</p:confirmDialog>
					</p:column>

				</p:dataTable>
		</h:form>

	</ui:define>
</ui:composition>
